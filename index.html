<!DOCTYPE html>
<html lang="en">
<head>
  <title>Evapotranspiration</title>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
</head>
<body>
<script>
    let width = 975;
    let height = 610;

    let svg = d3.select('body')
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    let path = d3.geoPath();

    let colors = [
        '#fee5d9',
        '#fcbba1',
        '#fc9272',
        '#fb6a4a',
        '#de2d26',
        '#a50f15'
    ];

    let colorScale = d3.scaleQuantize()
        .domain([0, 1.3])
        .range(colors);

    Promise.all([
            d3.json('us.json'),
            d3.csv('data.csv')
        ])
        .then(ready);

    function ready([us, data]) {
        let precipitationMap = {};
        data.forEach(d => {
            precipitationMap[d.id] = d.precipitation;
        });

        svg.append('g')
            .attr('class', 'counties')
            .attr('fill', 'none')
            .selectAll('path')
            .data(topojson.feature(us, us.objects.counties).features)
            .enter()
            .append('path')
            .attr('fill', d => {
                return colorScale(precipitationMap[d.id]);
            })
            .attr('stroke', '#808080')
            .attr('stroke-weight', '1px')
            .attr('d', path);

        svg.append('path')
            .datum(topojson.mesh(us, us.objects.states, (a, b) => { return a !== b; }))
            .attr('class', 'states')
            .attr('fill', 'none')
            .attr('stroke', '#000')
            .attr('stroke-width', '1px')
            .attr('d', path);

        svg.append('path')
            .datum(topojson.mesh(us, us.objects.nation))
            .attr('class', 'nation')
            .attr('fill', 'none')
            .attr('stroke', '#000')
            .attr('stroke-width', '1px')
            .attr('d', path);

        svg.append('rect')
            .attr('x', '0px')
            .attr('y', '510px')
            .attr('width', '300px')
            .attr('height', '100px')
            .attr('fill', '#fff');

        colors.forEach((color, i) => {
            svg.append('rect')
                .attr('width', '25px')
                .attr('height', '10px')
                .attr('x', `${i * 25 + 650}px`)
                .attr('y', '50px')
                .attr('fill', color);
        });
    }
</script>
</body>