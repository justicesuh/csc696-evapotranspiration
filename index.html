<!DOCTYPE html>
<html lang="en">
<head>
  <title>Evapotranspiration</title>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>
<body>
<script>
    let width = 975;
    let height = 610;

    // let bar = d3.select('body')
    //     .append('div')
    //     .style('width', '650px')
    //     .style('height', '25px')
    //     .style('border', '1px solid black');

    let svg = d3.select('body')
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    let path = d3.geoPath();

    let colors = [
        '#fdfffe',
        '#ee99c0',
        '#dd2e93',
        '#703a92',
        '#2a78ba',
        '#00b9ef',
        '#11b289',
        '#14ae4e',
        '#cad940',
        '#f8d73c',
        '#ee9f3a',
        '#c86d34',
        '#882927',
    ];

    let colorScale = d3.scaleQuantize()
        .domain([0, 1.3])
        .range(colors);

    Promise.all([
            d3.json('us.json'),
            d3.csv('data.csv')
        ])
        .then(ready);

    function ready([us, data]) {
        let precipitationMap = {};
        data.forEach(d => {
            precipitationMap[d.id] = d.precipitation;
        });

        svg.append('g')
            .attr('class', 'counties')
            .attr('fill', 'none')
            .selectAll('path')
            .data(topojson.feature(us, us.objects.counties).features)
            .enter()
            .append('path')
            .attr('fill', d => {
                return colorScale(precipitationMap[d.id]);
            })
            .attr('stroke', '#808080')
            .attr('stroke-weight', '1px')
            .attr('d', path);

        svg.append('path')
            .datum(topojson.mesh(us, us.objects.states, (a, b) => { return a !== b; }))
            .attr('class', 'states')
            .attr('fill', 'none')
            .attr('stroke', '#000')
            .attr('stroke-width', '1px')
            .attr('d', path);

        svg.append('path')
            .datum(topojson.mesh(us, us.objects.nation))
            .attr('class', 'nation')
            .attr('fill', 'none')
            .attr('stroke', '#000')
            .attr('stroke-width', '1px')
            .attr('d', path);
    }
</script>
</body>